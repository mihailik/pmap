{"version":3,"file":"index.js","sourceRoot":"","sources":["src/a-first/a-early.ts","src/a-first/mockPromise.ts","src/node/bootNode.ts","src/node/main.ts","src/x-last/x-run.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference lib=\"es2015\" />\r\nnamespace a_first {\r\n\r\n  if (typeof Promise === 'undefined') {\r\n    mockPromise();\r\n  }\r\n\r\n}","\r\n\r\nnamespace a_first {\r\n\r\n  export function mockPromise() {\r\n    const global = getGlobal();\r\n    global.Promise = promiseScope.Promise;\r\n  }\r\n\r\n  function getGlobal(this: any) {\r\n    if (typeof this !== 'undefined' && this)\r\n      return this;\r\n    else if (typeof global !== 'undefined' && global)\r\n      return global;\r\n    else if (typeof window !== 'undefined' && window)\r\n      return window;\r\n    else\r\n      return (new Function('return this')());\r\n  }\r\n\r\n  namespace promiseScope {\r\n\r\n    export function Promise(callback: (resolve: any, reject: any) => void) {\r\n      let done = false;\r\n      let success = false;\r\n      let promiseResult: any = null;\r\n      let promiseError: any = null;\r\n\r\n      let thens: { onsuccess: any, onerror: any }[] | undefined;\r\n\r\n      const callThens = () => {\r\n        if (thens) {\r\n          for (const th of thens) {\r\n            try {\r\n              // TODO: fire th.onsuccess or th.onerror\r\n            }\r\n            catch (error) {\r\n              // TODO: check with original promise\r\n            }\r\n          }\r\n        };\r\n\r\n        const resolve = (value: any) => {\r\n          if (done)\r\n            return;\r\n\r\n          done = true;\r\n          success = true;\r\n          promiseResult = value;\r\n        };\r\n\r\n        const reject = (error: any) => {\r\n\r\n        };\r\n\r\n        try {\r\n          callback(resolve, reject);\r\n        }\r\n        catch (error) {\r\n          reject(error);\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n}","namespace node {\r\n\r\n  export function bootNode() {\r\n    try {\r\n      const promise = main();\r\n      if (promise && typeof promise.then === 'function')\r\n        promise.then(\r\n          () => {\r\n            // success: OK\r\n          },\r\n          error => {\r\n            console.error(error);\r\n          });\r\n    }\r\n    catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n}","namespace node {\r\n\r\n  export async function main() {\r\n    let puppeteer: typeof import(\"puppeteer\");\r\n    try {\r\n      console.log('puppeteer...');\r\n      puppeteer = require('puppeteer');\r\n    }\r\n    catch (error) {\r\n      error.message = 'Google Puppeteer is missing: ' + error.message;\r\n      throw error;\r\n    }\r\n\r\n    console.log('browser...');\r\n    const browser = await puppeteer.launch({\r\n      headless: false\r\n    });\r\n\r\n    try {\r\n\r\n      console.log('mainPage...');\r\n      const mainPage = (await browser.pages())[0] || await browser.newPage();\r\n\r\n      await withBrowser(browser, mainPage);\r\n    }\r\n    finally {\r\n      console.log('close...');\r\n      await browser.close();\r\n    }\r\n  }\r\n\r\n  async function withBrowser(browser: import(\"puppeteer\").Browser, mainPage: import(\"puppeteer\").Page) {\r\n\r\n    const navigate = (async () => {\r\n      try {\r\n        console.log('goto...');\r\n        await mainPage.goto('http://maps.google.com/');\r\n      }\r\n      catch (error) {\r\n        return error\r\n      }\r\n    })();\r\n\r\n    await prompt('Navigate to the place and press ENTER');\r\n\r\n    const [width, height] = await mainPage.evaluate('[window.innerWidth, window.innerHeight]');\r\n    console.log({ width, height });\r\n\r\n    console.log('viewport/scale...')\r\n    await mainPage.setViewport({ width: width * 5, height: height * 5, deviceScaleFactor: 5 });\r\n\r\n    console.log('canvas...');\r\n    const canvasElem: import(\"puppeteer\").ElementHandle = await mainPage.evaluate(`(function() {\r\n    var canvasList = document.getElementsByTagName('canvas');\r\n    var maxW = 0, maxH = 0, maxCanvas;\r\n    for (var i = 0; i < canvasList.length; i++) {\r\n      var cv = canvasList[i];\r\n      var rect = cv.getBoundingClientRect();\r\n      if (rect.width * rect.height > maxW*maxH) {\r\n        maxW = rect.width;\r\n        maxH = rect.height;\r\n        maxCanvas = cv;\r\n      }\r\n    }\r\n    return maxCanvas;\r\n  })()`);\r\n    \r\n    console.log('canvas: ', canvasElem);\r\n\r\n    console.log('screenshot...');\r\n    canvasElem.screenshot({ path: './canvas.png' });\r\n\r\n    await prompt('exit');\r\n  }\r\n\r\n  function prompt(message?: string): Promise<string> {\r\n    return new Promise<string>((resolve, reject) => {\r\n\r\n      if (message)\r\n        process.stdout.write(message);\r\n\r\n      process.stdin.on('data', onData);\r\n      process.stdin.on('error', onError);\r\n\r\n      let buf = '';\r\n\r\n      function onData(dt: string | Buffer) {\r\n        buf += dt.toString();\r\n        if (/\\n/.test(buf)) {\r\n          unsubscribe();\r\n          resolve(buf);\r\n        }\r\n      }\r\n\r\n      function onError(error: any) {\r\n        unsubscribe();\r\n        reject(error);\r\n      }\r\n\r\n      function unsubscribe() {\r\n        process.stdin.off('data', onData);\r\n        process.stdin.off('error', onError);\r\n        }\r\n    });\r\n  }\r\n}","/// <reference types=\"node\" />\r\n\r\nnamespace x_last {\r\n\r\n  if (typeof WScript !== 'undefined') {\r\n    WScript.Echo('Download NODE using ActiveXObject and InternetExplorer.Application')\r\n  }\r\n  else if (typeof require === 'function' && typeof process !== 'undefined' && typeof module !== 'undefined' && process && module) {\r\n    node.bootNode();\r\n  }\r\n\r\n}"]}